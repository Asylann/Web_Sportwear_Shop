<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Dashboard ‚Äî WebSportwareShop</title>
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/dashboard.css" />
    <link rel="stylesheet" href="../css/components.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        .wallet-card {
            background: linear-gradient(135deg, #000000 0%, #333333 100%);
            color: white;
            padding: 40px;
            margin-bottom: 40px;
            border-left: 4px solid white;
            position: relative;
            overflow: hidden;
        }

        .wallet-card::before {
            content: 'üí≥';
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 4rem;
            opacity: 0.1;
        }

        .wallet-card-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .wallet-balance {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .wallet-currency {
            font-size: 1.2rem;
            opacity: 0.8;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .wallet-loading {
            font-size: 1.5rem;
            opacity: 0.7;
            font-weight: 600;
        }

        .user-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-info-item {
            background: var(--muted);
            padding: 20px;
            border-left: 3px solid var(--brand);
        }

        .user-info-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .user-info-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
<header class="dashboard-header">
    <div class="dashboard-header-content">
        <h1>üèÄ Welcome to WebSportwearShop</h1>
        <button onclick="logout()" id="logoutBtn" class="button">Logout</button>
    </div>
</header>

<nav class="dashboard-nav">
    <div class="dashboard-nav-content">
        <a id="nav-products" href="products.html" style="display: none;">Products</a>
        <a id="nav-orders" href="orders.html" style="display: none;">My Orders</a>
        <a id="nav-seller" href="seller.html" style="display: none;">Seller Panel</a>
        <a id="nav-admin" href="admin.html" style="display: none;">Admin Panel</a>
        <a id="nav-cart" href="cart.html" style="display: none;">My Cart</a>
    </div>
</nav>

<main class="dashboard-main">
    <div class="wallet-card">
        <div class="wallet-card-title">Your Wallet Balance</div>
        <div id="wallet-balance-amount" class="wallet-balance wallet-loading">Loading...</div>
        <div id="wallet-currency" class="wallet-currency" style="display: none;"></div>
    </div>

    <div class="dashboard-card">
        <h2>Your Dashboard</h2>
        <div id="user-info">
            <p>Loading user information...</p>
        </div>
    </div>

    <div class="dashboard-card">
        <h2>Quick Actions</h2>
        <div class="quick-actions">
            <div id="view-products-action" class="action-card" onclick="window.location.href='products.html'">
                <span class="icon">üõçÔ∏è</span>
                <h3>Browse Products</h3>
            </div>
            <div id="view-cart-action" class="action-card" style="display: none;" onclick="window.location.href='cart.html'">
                <span class="icon">üõí</span>
                <h3>My Cart</h3>
            </div>
            <div id="view-orders-action" class="action-card" style="display: none;" onclick="window.location.href='orders.html'">
                <span class="icon">üì¶</span>
                <h3>My Orders</h3>
            </div>
            <div id="seller-actions-btn" class="action-card" style="display: none;" onclick="window.location.href='seller.html'">
                <span class="icon">üì¶</span>
                <h3>Manage Products</h3>
            </div>
            <div id="admin-actions-btn" class="action-card" style="display: none;" onclick="window.location.href='admin.html'">
                <span class="icon">‚öôÔ∏è</span>
                <h3>Admin Panel</h3>
            </div>
        </div>
    </div>

    <div class="dashboard-card">
        <h2>System Status</h2>
        <div id="system-status" class="status-grid">
            <div class="status-item">
                <span class="status-icon">üü¢</span>
                <span class="status-text">System Online</span>
            </div>
            <div class="status-item">
                <span class="status-icon">üìä</span>
                <span class="status-text">Dashboard Active</span>
            </div>
            <div class="status-item">
                <span class="status-icon" id="user-status-icon">üë§</span>
                <span class="status-text" id="user-status">User Authenticated</span>
            </div>
        </div>
    </div>
</main>

<script src="../js/utils.js"></script>
<script src="../js/dashboard.js"></script>
<script>
    // Load wallet balance
    document.addEventListener("DOMContentLoaded", () => {
        loadWalletBalance();
    });

    function loadWalletBalance() {
        fetch('https://localhost:8081/api/wallet', {
            method: 'GET',
            credentials: "include"
        })
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}`);
                }
                return res.json();
            })
            .then(data => {
                if (data.data) {
                    const balance = data.data.balance || 0;
                    const currency = data.data.currency || 'KZT';

                    document.getElementById('wallet-balance-amount').textContent = `${balance.toFixed(2)}`;
                    document.getElementById('wallet-balance-amount').classList.remove('wallet-loading');

                    const currencyElement = document.getElementById('wallet-currency');
                    currencyElement.textContent = getCurrencySymbol(currency);
                    currencyElement.style.display = 'block';
                }
            })
            .catch(err => {
                console.error('Error loading wallet:', err);
                document.getElementById('wallet-balance-amount').textContent = 'Error loading balance';
                document.getElementById('wallet-balance-amount').classList.remove('wallet-loading');
            });
    }

    function getCurrencySymbol(currency) {
        const symbols = {
            'KZT': 'Kazakhstani Tenge (‚Ç∏)',
            'USD': 'US Dollar ($)',
            'EUR': 'Euro (‚Ç¨)',
            'RUB': 'Russian Ruble (‚ÇΩ)'
        };
        return symbols[currency] || currency;
    }
</script>
</body>
</html>